# 数据库设计文档

## 数据库概述

本系统采用MySQL作为关系型数据库，使用Spring Data JPA进行对象关系映射。数据库设计遵循第三范式，确保数据的一致性和完整性。

## 数据表清单

| 表名 | 说明 | 记录数估算 |
|------|------|------------|
| users | 用户表 | 1,000+ |
| categories | 图书分类表 | 10+ |
| books | 图书信息表 | 1,000+ |
| cart_items | 购物车表 | 5,000+ |
| orders | 订单表 | 2,000+ |
| order_items | 订单项表 | 10,000+ |

## 详细表结构

### users（用户表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|----|------|--------|------|
| user_id | BIGINT | - | √  | √ | AUTO_INCREMENT | 用户唯一标识 |
| username | VARCHAR | 50 | ×  | √ | - | 用户名，唯一 |
| password | VARCHAR | 255 | ×  | √ | - | 密码（加密存储） |
| email | VARCHAR | 100 | ×  | √ | - | 邮箱地址，唯一 |
| phone | VARCHAR | 20 | ×  | × | NULL | 手机号码 |
| address | TEXT | - | ×  | × | NULL | 收货地址 |
| created_at | TIMESTAMP | - | ×  | √ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ×  | √ | CURRENT_TIMESTAMP | 更新时间 |

**索引：**

主键索引：`PRIMARY KEY (user_id)`

唯一索引：`UNIQUE KEY uk_username (username)`

唯一索引：`UNIQUE KEY uk_email (email)`

### categories（图书分类表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|------|------|--------|------|
| category_id | BIGINT | - | √ | √ | AUTO_INCREMENT | 分类唯一标识 |
| category_name | VARCHAR | 100 | × | √ | - | 分类名称 |
| description | TEXT | - | × | × | NULL | 分类描述 |
| created_at | TIMESTAMP | - | × | √ | CURRENT_TIMESTAMP | 创建时间 |

**索引：**

主键索引：`PRIMARY KEY (category_id)`

### books（图书信息表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|------|------|--------|------|
| book_id | BIGINT | - | √ | √ | AUTO_INCREMENT | 图书唯一标识 |
| title | VARCHAR | 255 | × | √ | - | 图书标题 |
| author | VARCHAR | 100 | × | √ | - | 作者 |
| isbn | VARCHAR | 20 | × | √ | - | ISBN号，唯一 |
| price | DECIMAL | 10,2 | × | √ | 0.00 | 价格 |
| stock_quantity | INT | - | × | √ | 0 | 库存数量 |
| description | TEXT | - | × | × | NULL | 图书描述 |
| image_url | VARCHAR | 500 | × | × | NULL | 封面图片URL |
| category_id | BIGINT | - | × | × | NULL | 分类ID（外键） |
| created_at | TIMESTAMP | - | ×| √ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | × | √ | CURRENT_TIMESTAMP | 更新时间 |

**索引：**
1. 主键索引：`PRIMARY KEY (book_id)`
2. 唯一索引：`UNIQUE KEY uk_isbn (isbn)`
3. 外键索引：`FOREIGN KEY (category_id) REFERENCES categories(category_id)`
4. 普通索引：`INDEX idx_title (title)`
5. 普通索引：`INDEX idx_author (author)`

### cart_items（购物车表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|------|------|--------|------|
| cart_item_id | BIGINT | - | √ | √ | AUTO_INCREMENT | 购物车项ID |
| user_id | BIGINT | - | × | √ | - | 用户ID（外键） |
| book_id | BIGINT | - | × | √ | - | 图书ID（外键） |
| quantity | INT | - | × | √ | 1 | 商品数量 |
| added_at | TIMESTAMP | - | × | √ | CURRENT_TIMESTAMP | 添加时间 |

**索引：**
1. 主键索引：`PRIMARY KEY (cart_item_id)`
2. 外键索引：`FOREIGN KEY (user_id) REFERENCES users(user_id)`
3. 外键索引：`FOREIGN KEY (book_id) REFERENCES books(book_id)`
4. 唯一索引：`UNIQUE KEY uk_user_book (user_id, book_id)`

### orders（订单表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|------|------|--------|------|
| order_id | BIGINT | - | √ | √ | AUTO_INCREMENT | 订单唯一标识 |
| user_id | BIGINT | - | × | √ | - | 用户ID（外键） |
| total_amount | DECIMAL | 10,2 | × | √ | 0.00 | 订单总金额 |
| status | ENUM | - | × | √ | 'pending' | 订单状态 |
| shipping_address | TEXT | - | × | √ | - | 收货地址 |
| created_at | TIMESTAMP | - | × | √ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | × | √ | CURRENT_TIMESTAMP | 更新时间 |

**状态枚举值：**
1. `pending`：待处理
2. `confirmed`：已确认
3. `shipped`：已发货
4. `delivered`：已送达
5. `cancelled`：已取消

**索引：**
1. 主键索引：`PRIMARY KEY (order_id)`
2. 外键索引：`FOREIGN KEY (user_id) REFERENCES users(user_id)`
3. 普通索引：`INDEX idx_user_id (user_id)`
4. 普通索引：`INDEX idx_status (status)`
5. 普通索引：`INDEX idx_created_at (created_at)`

### order_items（订单项表）

| 字段名 | 数据类型 | 长度 | 主键 | 非空 | 默认值 | 说明 |
|--------|----------|------|----|------|--------|------|
| order_item_id | BIGINT | - | √  | √ | AUTO_INCREMENT | 订单项ID |
| order_id | BIGINT | - | ×  | √ | - | 订单ID（外键） |
| book_id | BIGINT | - | ×  | √ | - | 图书ID（外键） |
| quantity | INT | - | ×  | √ | 1 | 购买数量 |
| price | DECIMAL | 10,2 | ×  | √ | 0.00 | 购买时价格 |

**索引：**
1. 主键索引：`PRIMARY KEY (order_item_id)`
2. 外键索引：`FOREIGN KEY (order_id) REFERENCES orders(order_id)`
3. 外键索引：`FOREIGN KEY (book_id) REFERENCES books(book_id)`
4. 普通索引：`INDEX idx_order_id (order_id)`


## 关系说明

### 1. 用户相关关系
**用户 ↔ 购物车**：一对多（1:N）

**用户 ↔ 订单**：一对多（1:N）

### 2. 商品相关关系
**分类 ↔ 图书**：一对多（1:N）

**图书 ↔ 购物车**：一对多（1:N）  

**图书 ↔ 订单项**：一对多（1:N）

### 3. 订单相关关系
**订单 ↔ 订单项**：一对多（1:N）

## 数据完整性约束

### 1. 实体完整性
所有主键字段均不允许为空

所有主键值唯一

### 2. 参照完整性
所有外键字段必须引用已存在的主键

级联删除和更新策略根据业务需求设置

### 3. 用户定义完整性
价格字段必须大于等于0

库存数量必须大于等于0

邮箱格式验证

订单状态必须在指定枚举值内

## 性能优化策略

### 1. 索引优化
为频繁查询的字段建立索引

为外键字段建立索引

为联合查询字段建立复合索引

### 2. 查询优化
使用JOIN替代子查询

避免SELECT *，只查询需要的字段

对大文本字段使用延迟加载

### 3. 存储优化
使用合适的数据类型

对大文本字段使用TEXT类型

对价格等金额字段使用DECIMAL类型

## 初始数据脚本

```sql
-- 插入分类数据
INSERT INTO categories (category_name, description) VALUES 
('小说', '各类小说作品'),
('科技', '科学技术类图书'),
('历史', '历史类图书'),
('文学', '文学作品'),
('教育', '教育类图书');

-- 插入图书数据
INSERT INTO books (title, author, isbn, price, stock_quantity, description, category_id) VALUES 
('Java编程思想', 'Bruce Eckel', '9787111213826', 108.00, 50, 'Java编程经典书籍', 2),
('Spring Boot实战', 'Craig Walls', '9787115426958', 89.00, 30, 'Spring Boot开发指南', 2),
('三体', '刘慈欣', '9787536692930', 45.00, 100, '科幻小说', 1);

-- 插入测试用户
INSERT INTO users (username, password, email) VALUES 
('testuser', '123456', 'test@example.com');
